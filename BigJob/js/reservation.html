<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Réservation</title>
  <link rel="stylesheet" href="../style/calendrier.css">
  <style>
    .resv-wrap{max-width:560px;margin:28px auto;padding:18px;background:var(--card);border-radius:10px;border:1px solid var(--border)}
    label{display:block;margin-top:10px;font-weight:600}
    input[type=text],input[type=email]{width:100%;padding:8px;border:1px solid #e6e9ee;border-radius:6px;margin-top:6px}
    .actions{margin-top:14px;display:flex;gap:8px}
    .btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;border:1px solid var(--border)}
  </style>
</head>
<body>
  <div class="resv-wrap">
    <h2 id="resv-title">Réserver</h2>
    <p id="resv-date" style="color:var(--muted)"></p>

    <form id="resv-form">
      <label for="name">Nom</label>
      <input id="name" name="name" type="text" required>
      <label for="email">E-mail</label>
      <input id="email" name="email" type="email" required>
      <div class="actions">
        <button class="btn btn-primary" type="submit">Confirmer la réservation</button>
        <button class="btn btn-ghost" id="cancel" type="button">Annuler</button>
      </div>
    </form>

    <div id="result" style="margin-top:12px"></div>
  </div>

  <script>
    function qs(name){
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }
    const date = qs('date');
    const dateEl = document.getElementById('resv-date');
    const title = document.getElementById('resv-title');
    const form = document.getElementById('resv-form');
    const result = document.getElementById('result');
    const cancel = document.getElementById('cancel');

    if(!date){
      dateEl.innerText = 'Date invalide';
      form.style.display = 'none';
    } else {
      dateEl.innerText = date;
      title.innerText = `Réserver le ${date}`;
    }

    cancel.addEventListener('click', ()=>{ history.back(); });

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!date) return;
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      if(!name || !email){ result.innerText = 'Veuillez remplir tous les champs.'; return; }
      const storageKey = 'calendar-reservations';
      const raw = localStorage.getItem(storageKey);
      const reservations = raw ? JSON.parse(raw) : {};
      reservations[date] = {name, email, date, created: new Date().toISOString()};
      localStorage.setItem(storageKey, JSON.stringify(reservations));
      result.innerHTML = `<strong style="color:var(--accent)">Réservation enregistrée pour ${date}.</strong>`;
      setTimeout(()=>{ history.back(); }, 900);
    });
  </script>
</body>
</html>
